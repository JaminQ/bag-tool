<bag-include file="layout.html">
  <bag-slot name="title">Bag Tool</bag-slot>

  <bag-slot name="link">
    <link rel="stylesheet" href="./home.css">
  </bag-slot>

  <bag-slot name="body">
    <div class="page page-projects" :class="{ blur: infoMode || aboutMode }" @dragover.prevent @dragleave.prevent @dragend.prevent @drop.prevent="dropProject">
      <div class="poster" v-if="projects.length === 0">
        <h1 class="no-select">Bag Tool</h1>
      </div>

      <div class="projects-area" v-else @click="nowProjectIdx = '', logMode = false" :style="{ pointerEvents: logMoveStatus ? 'none' : 'inherit' }">
        <header class="projects-title">
          Projects
          <button v-if="projects.length" @click="editMode = !editMode" class="edit-projects">
            <i v-show="!editMode" title="编辑项目" class="far fa-edit fs-16"></i>
            <i v-show="editMode" title="完成" class="far fa-check-circle edit-projects-done fs-16"></i>
          </button>
        </header>

        <main :style="{ paddingBottom: (nowProjectIdx !== '' ? 70 : 0) + (logMode ? logHeight : 0) + 24 + 'px' }">
          <ul :class="{ 'edit-mode': editMode }">
            <li v-for="(project, project_i) in projects" @click.stop :class="{ 'move-mode': moveProjectIdx === project_i }" :style="{ top: projectTop + 'px' }">
              <label>
                <input type="radio" :value="project_i" v-model="nowProjectIdx" :disabled="editMode" @focus="inputFocus">
                <div class="project-main" :class="{ working: projects[project_i].workStatus }">
                  <i v-if="projects[project_i].workStatus === 'start'" class="project-icon far fa-play-circle"></i>
                  <i v-else class="project-icon fas fa-folder"></i>
                  <div class="project">
                    <div class="project-title">{{ project.title }}</div>
                    <div class="project-path">{{ project.path }}</div>
                  </div>
                  <button class="project-info" @click.stop="infoProject(project_i, project.title)"><i class="fas fa-info-circle fs-14" title="查看配置"></i></button>
                  <button class="project-del" @click.stop="removeProject(project_i)"><i class="fas fa-trash-alt fs-14" title="移除"></i></button>
                  <button class="project-move" @mousedown="moveProjectIdx = project_i, projectTop = 0"><i class="icon-move" title="移动"></i></button>
                </div>
              </label>
            </li>
          </ul>
          <transition name="zoom-in-down">
            <div v-show="delProjectIdx !== ''" class="delete-confirm-dialog">
              <div class="content">
                <p>确定要删除 {{ delProjectIdx !== '' ? projects[delProjectIdx].title : '' }} 吗？</p>

                <div class="btns">
                  <button class="btn btn-default" @click="delProjectIdx = ''">取消</button>
                  <button class="btn btn-error" @click="doRemoveProject">删除</button>
                </div>
              </div>
              <div class="mask"></div>
            </div>
          </transition>
          <div class="project-move-area" v-show="moveProjectIdx !== ''" @mousemove="movingProject"></div>
        </main>
      </div>

      <transition name="slide-updown">
        <div v-show="nowProjectIdx !== ''" class="work-area" :style="{ bottom: (logMode ? logHeight : 0) + 24 + 'px' }">
          <button class="btn" :class="{ working: nowProject.workStatus === 'build' }" @click="gulp(nowProjectIdx, 'build')">编译{{ nowProject.workStatus === 'build' ? '中...' : '' }}</button>
          <button class="btn" :class="{ working: nowProject.workStatus === 'start' }" @click="gulp(nowProjectIdx, 'start')">监听{{ nowProject.workStatus === 'start' ? '中...' : '' }}</button>
          <button class="btn" :class="{ working: nowProject.workStatus === 'clean' }" @click="gulp(nowProjectIdx, 'clean')">清理{{ nowProject.workStatus === 'clean' ? '中...' : '' }}</button>
        </div>
      </transition>

      <div v-show="logMode" class="log-area" :style="{ height: logHeight + 'px' }">
        <button class="log-empty-btn" :style="{ bottom: logHeight + 'px' }" @click="clearLog(nowProjectIdx)"><i title="清空日志" class="fas fa-trash-alt fs-14"></i></button>
        <code v-html="nowProject.logContent"></code>

        <div class="drag-bar" :style="{ bottom: logHeight + 20 + 'px' }" @mousedown="logMoveStatus = true"></div>
        <div class="drag-move-area" v-show="logMoveStatus" @mousemove="logMoving"></div>
      </div>

      <div class="bottom-bar">
        <button class="function-btn" @click="addProjects"><i title="添加新项目" class="fas fa-plus fs-14"></i></button>
        <button class="function-btn" :disabled="nowProjectIdx === ''" @click="openProject(projects[nowProjectIdx].path)"><i title="打开项目目录" class="far fa-folder-open fs-14"></i></button>
        <button class="function-btn" :disabled="nowProjectIdx === ''" @click="exportProject"><i title="打包并压缩项目输出目录" class="fas fa-cube fs-14"></i></button>
        <button class="function-btn" @click="aboutUs"><i title="关于" class="far fa-question-circle fs-14"></i></button>

        <div class="function-right-btns">
          <button class="function-btn" :disabled="nowProjectIdx === ''" :class="{ 'log-mode': logMode }" @click="logMode = !logMode"><i title="查看日志" class="fas fa-terminal fs-14"></i></button>
        </div>
      </div>
    </div>

    <transition name="fade-in">
      <div class="page transparent-page page-info" v-if="infoMode">
        <div class="info-btns">
          <button @click="openUrl('https://github.com/JaminQ/bag-tool/blob/master/README.md#config')"><i class="far fa-question-circle fs-20" title="帮助"></i></button>
          <button @click="saveInfo"><i class="far fa-times-circle fs-20" title="保存并关闭"></i></button>
        </div>

        <div class="info-block">
          <header>项目配置</header>

          <main>
            <div class="form-tips">项目目录，路径相对当前项目</div>

            <div>
              <label class="form-row">
                <div class="form-label form-title">源目录</div>
                <input type="text" v-model="info.src">
              </label>
            </div>

            <div>
              <label class="form-row">
                <div class="form-label form-title">生产目录</div>
                <input type="text" v-model="info.dest">
              </label>
            </div>

            <div>
              <label class="form-row">
                <div class="form-label form-title">母版目录</div>
                <input type="text" v-model="info.template">
              </label>
            </div>

            <div class="form-tips">其余配置</div>

            <div>
              <label class="form-row">
                <div class="form-label form-title">编码集</div>
                <input type="text" v-model="info.encoding">
              </label>
            </div>

            <div>
              <label class="form-row">
                <input type="checkbox" v-model="info.showDetailLog" @focus="inputFocus">
                <div class="form-label">是否打印详细log</div>
              </label>
            </div>
          </main>
        </div>

        <div class="info-block">
          <header>LiveReload</header>

          <main>
            <div>
              <label class="form-row">
                <input type="checkbox" v-model="info.liveReload" @focus="inputFocus">
                <div class="form-label">开启 LiveReload 浏览器自动刷新</div>
              </label>
            </div>

            <div>
              <label class="form-row" v-show="info.liveReload">
                <input class="form-margin-left" type="text" v-model="info.startPath">
                <div class="form-label">默认加载的路径</div>
              </label>
            </div>
          </main>
        </div>

        <div class="info-block">
          <header>母版引擎</header>

          <main>
            <div class="form-tips">支持的文件后缀名</div>

            <div v-for="(extname, idx) in info.tmplExtname">
              <label class="form-row">
                <input type="text" v-model="info.tmplExtname[idx]">
                <button class="form-delete" @click="arrRemove(info.tmplExtname, idx)"></button>
              </label>
            </div>

            <div>
              <label class="form-row">
                <button class="form-add" @click="arrAdd(info.tmplExtname)"></button>
              </label>
            </div>
          </main>
        </div>

        <div class="info-block">
          <header>CSS预处理</header>

          <main>
            <div class="form-tips">勾选你需要使用的CSS预处理引擎：</div>

            <div>
              <label class="form-row">
                <input type="checkbox" v-model="info.cssEngine" value="less" @focus="inputFocus">
                <div class="form-label">Less</div>
              </label>
            </div>

            <div>
              <label class="form-row">
                <input type="checkbox" v-model="info.cssEngine" value="sass" @focus="inputFocus" disabled>
                <div class="form-label">Sass<span class="form-tips">（GUI版本暂不支持Sass）</span></div>
              </label>
            </div>
          </main>
        </div>

        <div class="info-block">
          <header>文件白名单</header>

          <main>
            <div class="form-tips">以下文件将直接复制到生产目录，路径相对源目录</div>

            <div v-for="(file, idx) in info.whiteList">
              <label class="form-row">
                <input class="long" type="text" v-model="info.whiteList[idx]">
                <button class="form-delete" @click="arrRemove(info.whiteList, idx)"></button>
              </label>
            </div>

            <div>
              <label class="form-row">
                <button class="form-add" @click="arrAdd(info.whiteList)"></button>
              </label>
            </div>
          </main>
        </div>

        <div class="info-block">
          <header>忽略的文件或目录</header>

          <main>
            <div class="form-tips">路径相对源目录</div>

            <div v-for="(file, idx) in info.ignore">
              <label class="form-row">
                <input class="long" type="text" v-model="info.ignore[idx]">
                <button class="form-delete" @click="arrRemove(info.ignore, idx)"></button>
              </label>
            </div>

            <div>
              <label class="form-row">
                <button class="form-add" @click="arrAdd(info.ignore)"></button>
              </label>
            </div>
          </main>
        </div>
      </div>
    </transition>

    <transition name="fade-in">
      <div class="page transparent-page page-about" v-if="aboutMode">
        <div class="about-btns">
          <button @click="closeAboutPage"><i class="far fa-times-circle fs-20" title="关闭"></i></button>
        </div>

        <div class="logo">
          <img src="../../imgs/Icon/png/iconr.png" alt="logo" draggable="false">
        </div>

        <h3 class="title">Bag Tool</h3>

        <div class="version">
          <p>GUI Version 0.0.1</p>
          <p>CLI Version 1.0.7</p>
        </div>

        <div class="decoration">一个基于<a href="javascript:;" draggable="false" @click="openUrl('https://gulpjs.com')">Gulp</a>的前端工作流程序</div>

        <button class="btn like">
          <i class="far fa-thumbs-up fs-14"></i> 赞赏
          <img class="reward" src="../../imgs/reward.jpg" alt="赞赏码" draggable="false">
        </button>

        <div class="shortcut">
          <p class="shortcut-title">快捷键说明</p>

          <div class="shortcut-main">
            <div class="shortcut-item">
              <div class="code">
                <code>Ctrl</code>
                <code>.</code>
              </div>
              <div class="text">开/关日志面板</div>
            </div>

            <div class="shortcut-item">
              <div class="code">
                <code>Up</code>
              </div>
              <div class="text">上移当前选中的项目</div>
            </div>

            <div class="shortcut-item">
              <div class="code">
                <code>Down</code>
              </div>
              <div class="text">下移当前选中的项目</div>
            </div>

            <div class="shortcut-item">
              <div class="code">
                <code>Esc</code>
              </div>
              <div class="text">各种返回和取消</div>
            </div>

            <div class="shortcut-item">
              <div class="code">
                <code>Ctrl</code>
                <code>Alt</code>
                <code>E</code>
              </div>
              <div class="text">最小化/恢复</div>
            </div>
          </div>
        </div>

        <div class="author-area">
          <label>Author:</label>
          <a class="author" href="javascript:;" draggable="false" @click="openUrl('https://github.com/JaminQ')">Jamin Qian</a>
          <img class="avatar" src="../../imgs/avatar.jpg" alt="头像" draggable="false">
        </div>

        <div class="link">
          <button class="btn btn-default" @click="openUrl('https://github.com/JaminQ/bag-tool')">Github</button>
          <button class="btn btn-error" @click="openUrl('https://www.npmjs.com/package/bag-tool')">NPM</button>
          <button class="btn" @click="openUrl('https://github.com/JaminQ/bag-tool/blob/master/README.md')">README</button>
        </div>
      </div>
    </transition>
  </bag-slot>

  <bag-slot name="script">
    <script type="text/javascript">
      require('./home.js');
    </script>
  </bag-slot>
</bag-include>